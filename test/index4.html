<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <meta charset="utf-8" />
    <title>同城</title>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <link rel="stylesheet" href="css/materialize.min.css">

   

    <style>
        body {
            background: linear-gradient(90deg, #ffffff, #d2e0f8)
        }

        /* .container {
            width: 100%;
            height: 35rem;

            float: right;
            display: flex;
        } */

        .btn_container {
            width: 100%;
            height: 10rem;
            text-align: center;
        }

        .btn_container:after {
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
        }

        #toast-container {
            top: 80%;
            right: 45%;
        }

        .bubbles{
            stroke-width:2px;
            stroke:white;
        }
        .bubbles:hover{
            stroke:green;
        }
    </style>
</head>
<script>   
    function show()
                {
                    console.log("5的位置");
                    
                    return "./wordCloud.jpg"
                   
                }
</script>


    <nav style="background:#007497e0">
        <div class="nav-wrapper">
            <a href="main.html" class="brand-logo" style="margin-left: 1rem;font-size: 1.2rem; ">同城数据可视化</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="https://www.douban.com/location/hangzhou/events/future-music">豆瓣同城页面</a></li>
               
            </ul>
        </div>
    </nav>
    <!-- <div id="container" class="container"></div> -->

    <div class="row" style="
    margin-top: 10px;
    display: flex;">

        <ul class="collapsible" data-collapsible="accordion" style="
        margin-left: 4rem;width: 26rem">
            <li class="active">
                <div class="collapsible-header">样本数据</div>
                <div class="collapsible-body" style="display: block;">
                    <div class="row">
                        <form class="col s12">
                            <div class="row">
                                <div class="input-field col s12">
                                    <textarea id="ta" class="materialize-textarea"
                                        style="border-bottom: 0px;width: 24rem; height:18em"></textarea>
                                    <label for="textarea1" id="t1">
                                        <!-- name,avgPrice_music<br> -->
                                       「回暖」2021春夏巡演,298.5<br>
                                        张杰「曜·北斗」演唱会,762.5<br>
                                        张韶涵“寓言”世界巡回演唱会,512.5<br>
                                        久石让钢琴曲梦幻之旅演奏会,332.5<br>
                                        久石让·宫崎骏音乐会,244.5<br>
                                        “直到世界尽头”经典动漫演唱会,284.5<br>
                                        2021汪峰演唱会,512.5<br>
                                        德国原版绘本启蒙交响音乐会,1491.0<br>
                                        痛仰乐队「世界会变好」,799.0<br>
                                        马克西姆古典跨界钢琴演奏会,736.5<br>
                                        《感谢你爱我》 2021巡游记,293.5<br>
                                        杭盖2021乘风而归全国巡演,667.5<br>
                                        2021圣诞超级枕头大战,128<br>
                                        暖冬摇滚「潜入黑镜」黑屋,150<br>
                                        【杭州站】「Fine乐团」,816.0<br>
                                        李大奔「野望」2021全国巡演 杭州站,459.0<br>
                                        「脑浊乐队」2021全国巡演 杭州站,362.0
                                    </label>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </li>

          
           </li>
            <li class="btn_container"  onclick="show()">
                <a class="waves-effect waves-light btn-large">生成wordCloud</a>
                <!-- <img src="x" onerror="javscript:this.scr=javascript:show()" width="350px" alt="图片未加载" /> -->
            </li>
            <img src="wordcloud.jpg" width="380px" height="240px" alt="图片未加载" />
            <!-- <script>
            function c1(){
                <img src="wordcloud.jpg" width="350px" alt="图片未加载" />
            }
           </script> -->
        </ul>
 





        <div class="col s12 m7" style="
            float: right;
            margin-right: 4rem;
        ">

            <div class="card">
                <script>
                
                var width1=700
                var height1=500
                console.log(width1,height1);
        
                d3.select("#container")
                .attr("width",width1)
                .attr("height",height1)

                
          

                // d3.select("#container3")
                // .attr("width",width1)
                // .attr("height",height1)

                </script>
                    
                <div id="container" class="card-image container" style="fill:white">
                   
                    
               
               

                    <svg height="500" width="700" id="container3" class="svgs" style="fill:white">
                        
                            <rect x="0" y="0" width="800" height="500" rx="0" ry="10"
                                  style="fill:white"/>
                    </svg> 
                    <script>
            
                     
                        
                        d3.csv("connectedscatter1.csv", function(data) {
                        console.log(1111,data)   
                        console.log("width1",width1)  
                        console.log("height1",height1)  
                        
                       
                        
                        var margin = {top: height1*0.1,  bottom:  height1*0.1, left: width1*0.1, right:  width1*0.15};
                        // var margin = {top: 20, right: 30, bottom: 40, left: 90},
                        console.log(margin.left)
                        console.log(margin.right)
                        

                        const innerWidth = width1 - margin.left - margin.right;
                        const innerHeight = height1 - margin.top - margin.bottom;
                        const g = d3.selectAll("#container3")
                            .append("g")
                            .attr('id', 'maingroup')
                            .attr("width",innerWidth)
                            .attr("height",innerHeight)
                            .append("g")
                            .attr('transform', `translate(${margin.left}, ${margin.top})`);
                        console.log("innerWidth",innerWidth)
                        console.log("innerHeight",innerHeight)

                    

                        var allGroup=["avgPrice_music","avgPrice_drama","avgPrice_exhibition","avgPrice_sports"]
                        var allGroup1=["音乐会票价","戏剧节票价","展览会票价","运动馆票价"]

                        var dataReady=allGroup.map(function(grpName){
                            return {
                                name:grpName,
                                values:data.map(function(d){
                                    return{
                                        id:d.id,
                                        value:+d[grpName]
                                    };
                                })
                            }
                        })
                        var dataReady1=allGroup.map(function(grpName){
                            return {
                                name:grpName,
                                values:data.map(function(d){
                                    return{
                                        id:d.id,
                                        value:+d[grpName]
                                    };
                                })
                            }
                        })

                        console.log("dataReady",dataReady)

                        var myColor=d3.scaleOrdinal()
                                      .domain(allGroup)
                                      .range(d3.schemeSet2);

                        // X axis
                        var x = d3.scaleLinear()
                            .domain([0, 20]) //比例尺值域
                            .range([0, innerWidth]); //输入的值
                        g.append("g")
                            .attr("transform", "translate(0," + innerHeight + ")")
                            .call(d3.axisBottom(x))
                    
                            
                        // Y axis
                        var y = d3.scaleLinear()
                            .domain([0,2600])
                            .range([innerHeight,0])
                        g.append("g")
                            .call(d3.axisLeft(y))

                        // Add the lines
                        var line=d3.line()
                                   .x(function(d){
                                       return x(d.id)
                                   })
                                   .y(function(d){
                                       return y(d.value)
                                   })
                                   

                        g.selectAll("myLines")
                         .data(dataReady)
                         .enter()
                         .append("path")//画线
                         .attr("class",function(d){
                             return d.name
                         })
                         .attr("d",function(d){
                             console.log("d.name",d.name)
                             
                             console.log("d.values",d.values)
                             return line(d.values)
                         })
                         .attr("stroke",function(d){
                             return myColor(d.name)
                         })
                         .style("stroke-width",4)
                         .style("fill","none")
                       




                        // Add the points
                        g.selectAll("myDots")
                        .data(dataReady)
                        .enter()
                        .append('g')
                        .style("fill",function(d){
                            return myColor(d.name)
                        })
                        .attr("class",function(d){
                            return d.name
                        })

                        .selectAll("myPoints")
                        .data(function(d){
                            return d.values
                        })
                        .enter()
                        .append("circle")
                        .attr("cx",function(d){
                            return x(d.id)
                        })
                        .attr("cy",function(d){
                            return y(d.value)
                        })
                        .attr("r",5)
                        .attr("stroke","white")
                        .text(function(d){
                            return d.value;
                        })
                       
                         .style("font-size",12)




                        //在每一行的末尾添加一个标签
                        g.selectAll("myLabels")
                        .data(dataReady)
                        .enter()
                        .append('g')
                        .append('text')
                        .attr("class",function(d){
                            return d.name
                        })
                        .datum(function(d){
                            return{
                                name:d.name,
                                // 只保留每个时间序列的最后一个值
                                value:d.values[d.values.length-1]
                            }
                        })
                        .attr("transform",function(d){
                            // 将文本放在最后一个点的位置
                            return "translate("+x(d.value.id)+","+y(d.value.value)+")"

                        })
                        // 将文本向右移动一点
                        .attr("x",12)
                        // .attr("y",innerHeight)
                        .text(function(d){
                            return d.name;
                        })
                        .style("fill",function(d){
                            return myColor(d.name)
                        })
                        .style("font-size",10)

                       
                        // 添加图例（交互式）点击
                        g.selectAll("myLegend")
                         .data(dataReady1)
                         .enter()
                         .append('g')
                         .append("text")
                         .attr('x',function(d,i){
                             return -50+i*150
                         })
                         .attr('y',-20)
                         .text(function(d){
                             return d.name;
                         })
                         .style("fill",function(d){
                             return myColor(d.name)
                         })
                         .style("font-size",14)
                         
                         .on("click",function(d){
                            // 该元素当前可见吗？
                             currentOpacity=d3.selectAll('.'+d.name).style("opacity")
                            //  更改不透明度：从 0 到 1 或从 1 到 0
                            d3.selectAll("."+d.name).transition().style("opacity",currentOpacity==1?0:1)

                         })


                        
                    })
</script>

                    <!-- <span class="card-title" style="color: #868181;">Graph</span> -->
                </div>


                <div class="card-content" style="background: aliceblue;">
                    <p>基于d3.js构建</p>
               </div> 
               
            </div>
        </div>
    </div>
   


